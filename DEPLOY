#!/bin/bash
if [ -z "$VIRTUAL_ENV" ]; then
  source venv.sh
fi

if [[ $1 == "bootstrap" ]]; then
  if [[ $EUID -ne 0 ]]; then
    echo "Must run bootstrap role as root"
    exit 1
  fi
  # TODO: decrypt ~/.ssh/id_github with gpg
  ansible-playbook -i hosts -l "$(hostname)" bootstrap.yml -vvv
  chown -R "$USER:$USER" /usr/local
else
  ansible-playbook -i hosts -l "$(hostname)" site.yml -v --ask-become-pass --tags="$1"
fi
