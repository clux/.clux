---
- hosts: kjttks
  connection: local
  user: root
  gather_facts: no
  pre_tasks:
    - name: install python2 for ansible
      raw: pacman -S --noconfirm python-simplejson

  tasks:
    - name: sudo
      pacman: name=sudo state=installed

    - name: ensure {{ desktop_user }} exists
      user:
        name={{ desktop_user }}
        state=present
        groups=audio,video,games,rfkill,uucp,wheel
        # TODO: generate ssh keys here

    - name: allow wheel users to sudo with pass
      lineinfile:
        dest=/etc/sudoers
        backrefs=yes
        regexp='^\#(%wheel ALL\=\(ALL\) ALL)$'
        line='\1'
        validate='visudo -cf %s'

    - name: enable multilib for steam
      lineinfile:
        dest=/etc/pacman.conf
        backrefs=yes
        regexp="^\#\[multilib\]"
        line="[multilib]\nInclude = /etc/pacman.d/mirrorlist"

    - name: install display drivers and xorg
      pacman: name={{ item }} state=installed
      with_items:
        - nvidia
        - nvidia-libgl
        - libevdev

    - name: install core display utilities
      pacman: name={{ item }} state=installed
      with_items:
        - alsa-utils
        - cinnamon
        - lightdm
        - lightdm-gtk-greeter
        - ttf-dejavu
        - ttf-liberation
        - guake
        - chromium

    - name: enable lightdm gtk greeter
      lineinfile:
        dest=/etc/lightdm/lightdm.conf
        backrefs=yes
        regexp="^#greeter-session\="
        line="greeter-session=lightdm-gtk-greeter"

    - name: enable lightdm
      service: name=lightdm enabled=yes

  #roles:
  #  - bootstrap
